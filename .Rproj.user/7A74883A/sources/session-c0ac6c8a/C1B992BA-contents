

```markdown
# AutoCellType - å•ç»†èƒè½¬å½•ç»„æ™ºèƒ½æ³¨é‡Šå·¥å…·åŒ…

![](https://img.shields.io/badge/R-3.6%2B-blue)
![](https://img.shields.io/badge/License-MIT-green)

åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å•ç»†èƒè½¬å½•ç»„ç»†èƒç±»å‹æ³¨é‡Šå·¥å…·ï¼Œæ”¯æŒå¤šæ¨¡å‹æ™ºèƒ½æ ‡æ³¨ä¸ç»“æœæ•´åˆã€‚

## ğŸ“¦ å®‰è£…æŒ‡å—

### ç¨³å®šç‰ˆå®‰è£…
```r
# é€šè¿‡GitHubå®‰è£…ä¸»åŒ…
devtools::install_github("username/AutoCellType")
```

### å¼€å‘ç‰ˆå®‰è£…
```r
# åŒ…å«å®éªŒæ€§åŠŸèƒ½
devtools::install_github("username/AutoCellType@develop")
```

### ä¾èµ–å®‰è£…
```r
# CRANä¾èµ–
install.packages(c("dplyr", "purrr", "tibble", "parallel", "httr", "jsonlite",
                   "future", "future.apply", "lubridate", "ggplot2"))

# Bioconductorä¾èµ–
if (!require("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install("Seurat")

# å¯é€‰å¯è§†åŒ–åŒ…
install.packages(c("patchwork", "scRNAtoolVis", "TheBestColors"))
```


## ğŸš€ å¿«é€Ÿå…¥é—¨

### 1. é…ç½®APIå¯†é’¥
```r
Sys.setenv(OPENAI_API_KEY = "sk-your-key-here")       # APIå¯†é’¥
Sys.setenv(OPENAI_API_BASE_URL = "https://api.gpt.ge/v1")  # æœåŠ¡ç«¯ç‚¹
```

### 2. åŸºç¡€æ³¨é‡Š
```r
library(AutoCellType)

# è½½å…¥ç¤ºä¾‹æ•°æ®é›†
data(sample_markers)

# å•æ¨¡å‹æ³¨é‡Š
basic_result <- AutoCellType(
  input = sample_markers,
  annotation_level = 'subtype',
  tissuename = "è‚ç™Œå¾®ç¯å¢ƒ",
  cellname = 'Tç»†èƒ',
  model = 'deepseek-v3'
)
```

### 3. å¤šæ¨¡å‹é›†æˆ
```r
# å¹¶è¡Œå¤šæ¨¡å‹æ³¨é‡Š
multi_result <- RunMultipleAnnotations(
  input = sample_markers,
  models = c('gpt-4o', 'deepseek-v3', 'claude-3-opus'),
  tissuename = "è‚ç»†èƒç™Œç»„ç»‡",
  cellname = 'å†…çš®ç»†èƒ',
  topgenenumber = 40,
  max_retries = 5,
  timeout = 600
)
```


## ğŸ“š æ ¸å¿ƒå‡½æ•°è¯¦è§£

### `AutoCellType` å‡½æ•°


| å‚æ•°               | ç±»å‹       | é»˜è®¤å€¼ | è¯´æ˜                                                                 |
  |--------------------|------------|--------|--------------------------------------------------------------------|
  | input              | data.frame | å¿…é€‰   | è¾“å…¥markerçŸ©é˜µï¼Œéœ€åŒ…å«cluster/gene/avg_log2FCä¸‰åˆ—                     |
  | annotation_level   | character  | 'major'| æ³¨é‡Šç²’åº¦: 'major'(å¤§ç±»)/'subtype'(äºšå‹)                             |
  | model              | character  | å¿…é€‰   | è¯­è¨€æ¨¡å‹é€‰æ‹©: 'gpt-4o'/'deepseek-v3'ç­‰                                |
  | tissuename         | character  | å¿…é€‰   | ç»„ç»‡ç±»å‹æè¿°ï¼Œå¦‚"è‚ºç™Œè½¬ç§»ç¶"                                        |
  | cellname           | character  | NULL   | ä¸»ç»†èƒç±»å‹ï¼ˆäºšå‹åˆ†ææ—¶å¿…éœ€ï¼‰ï¼Œå¦‚"Tç»†èƒ"ã€"æˆçº¤ç»´ç»†èƒ"                |
  | topgenenumber      | integer    | 15     | æ¯ä¸ªclusterä½¿ç”¨çš„TOPåŸºå› æ•°ï¼ˆæ¨èèŒƒå›´ï¼š20-50ï¼‰                         |
  | base_url           | character  | å¿…é€‰   | APIæœåŠ¡ç«¯åœ°å€                                                       |
  | api_key            | character  | å¿…é€‰   | APIè®¤è¯å¯†é’¥                                                         |


  ### `RunMultipleAnnotations` å‡½æ•°


  | æ–°å¢å‚æ•°          | ç±»å‹       | é»˜è®¤å€¼ | è¯´æ˜                                                                 |
  |-------------------|------------|--------|--------------------------------------------------------------------|
  | models            | character  | å¿…é€‰   | æ¨¡å‹åˆ—è¡¨ï¼Œä¾‹å¦‚c('gpt-4o','claude-3-sonnet')                          |
  | max_retries       | integer    | 3      | å•æ¨¡å‹æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå»ºè®®3-5æ¬¡                                      |
  | timeout           | integer    | 300    | å•æ¬¡APIè°ƒç”¨è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰                                           |
  | parallel_workers  | integer    | 4      | å¹¶è¡Œå·¥ä½œçº¿ç¨‹æ•°ï¼ˆå»ºè®®ä¸è¶…è¿‡CPUæ ¸å¿ƒæ•°ï¼‰                               |

  ## ğŸ” ç»“æœè§£æ


  ```r
# æŸ¥çœ‹ç®€æ´ç»“æœ
head(results[, c("Cluster", "Prediction", "Model")])

# ç»“æœç»Ÿè®¡
library(dplyr)
results %>%
  group_by(Cluster, Model) %>%
  summarise(Dominant_Type = names(which.max(table(Prediction))),
            Confidence = max(table(Prediction))/n())
```


## ğŸ’¡ ä½¿ç”¨æŠ€å·§

1. **åŸºå› æ•°é‡é€‰æ‹©**
  - å¤§ç±»æ³¨é‡Šï¼š15-30åŸºå› 
- ç²¾ç»†äºšå‹ï¼š30-50åŸºå› 

2. **æ¨¡å‹é€‰æ‹©ç­–ç•¥**
  ```r
# æ¨èç»„åˆ
optimal_models <- c(
  'claude-3-sonnet',  # ç”Ÿç‰©åŒ»å­¦æ–‡çŒ®å¼ºé¡¹
  'gpt-4-turbo',      # ç»¼åˆæ¨ç†èƒ½åŠ›å¼º
  'deepseek-v3'       # ä¸­æ–‡æ”¯æŒä¼˜å¼‚
)
```

3. **å¼‚å¸¸å¤„ç†**
  ```r
tryCatch({
  result <- AutoCellType(...)
}, error = function(e) {
  message("é‡åˆ°APIé”™è¯¯: ", e$message)
  saveRDS(markers, "backup_markers.rds")  # è‡ªåŠ¨ä¿å­˜å½“å‰è¿›åº¦
})
```


## ğŸ“Š å¯è§†åŒ–å±•ç¤º

<img src="https://example.com/annotation_workflow.png" width="800" alt="å·¥ä½œæµç¨‹å›¾">


  ## â“ å¸¸è§é—®é¢˜

  **Q1: å¦‚ä½•å¤„ç†APIé™æµï¼Ÿ**
  - é™ä½å¹¶è¡Œæ•° `parallel_workers=2`
- å¯ç”¨æŒ‡æ•°é€€é¿é‡è¯• `backoff=TRUE`
- è”ç³»æœåŠ¡å•†æå‡é…é¢

**Q2: å¦‚ä½•æå‡æ³¨é‡Šå‡†ç¡®æ€§ï¼Ÿ**
  ```r
é«˜çº§é…ç½® <- list(
  æ¸©åº¦å‚æ•° = 0.3,       # é™ä½è¾“å‡ºéšæœºæ€§ (èŒƒå›´0-1)
  ç³»ç»Ÿæç¤º = "ä½ æ˜¯ä¸€ä¸ªä¸¥è°¨çš„ç»†èƒç”Ÿç‰©å­¦å®¶...",
  å¢å¼ºæç¤º = "ä½¿ç”¨æœ€æ–°Cell Ontologyæœ¯è¯­..."
)
```


## ğŸ“œ å‚è€ƒæ–‡çŒ®

1. å•ç»†èƒæ³¨é‡Šæ ‡å‡†æŒ‡å—ï¼ˆ2025ï¼‰
2. LLMåœ¨ç”Ÿç‰©åŒ»å­¦åº”ç”¨ç™½çš®ä¹¦ï¼ˆ2024ï¼‰
3. [æ–¹æ³•å­¦ç»†èŠ‚](https://example.com/methods)


## ğŸ“§ æ”¯æŒä¸è”ç³»

é‡åˆ°é—®é¢˜è¯·æäº¤issueæˆ–è”ç³»:
  - é¡¹ç›®ä¸»é¡µ: https://github.com/username/AutoCellType
- æŠ€æœ¯é‚®ç®±: support@celltype.ai
- å¾®ä¿¡äº¤æµç¾¤: æ‰«ç åŠ å…¥

<img src="https://example.com/wechat_qr.jpg" width="200" align="center">


  ## è®¸å¯è¯

  MIT Â© 2024-Present AutoCellType Team
```
